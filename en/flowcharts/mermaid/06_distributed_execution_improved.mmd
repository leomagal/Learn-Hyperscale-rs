graph TD
    A["ğŸš€ Block Committed<br/>Ready for Execution"] --> B["ğŸ“‹ Categorize Transactions<br/>1. Retry (high priority)<br/>2. Priority (CommitmentProof)<br/>3. Normal"]
    
    B --> C["ğŸŸ¢ Execute Retry Transactions<br/>Failed in previous blocks"]
    C --> D["ğŸ“Š Detect Conflicts<br/>DependencyGraph"]
    
    D --> E{"Conflict<br/>Detected?"}
    
    E -->|No| F["âœ… Execute Successfully<br/>Update State"]
    E -->|Yes| G["ğŸ” Livelock Check<br/>Cycle Detection"]
    
    G --> H{"Cycle<br/>Detected?"}
    
    H -->|No| I["âš™ï¸ Resolve Conflict<br/>Choose winner"]
    I --> J["ğŸŸ¡ Defer Loser<br/>Retry in next block"]
    J --> F
    
    H -->|Yes| K["ğŸš¨ Cycle Found<br/>Deadlock Prevention"]
    K --> L["â¸ï¸ Defer Transaction<br/>Queue for retry"]
    L --> F
    
    F --> M["ğŸŸ¢ Execute Priority Transactions<br/>With CommitmentProof"]
    M --> N["ğŸ”— Cross-Shard Coordination<br/>Verify CommitmentProof"]
    N --> O{"Proof<br/>Valid?"}
    
    O -->|No| P["âŒ Reject<br/>Invalid proof"]
    P --> M
    
    O -->|Yes| Q["âœ… Execute<br/>Update State"]
    Q --> R["ğŸŸ¢ Execute Normal Transactions<br/>Standard execution"]
    R --> S["âš™ï¸ Apply Writes<br/>Update Jellyfish Merkle Tree"]
    
    S --> T["ğŸ“Š Detect Conflicts<br/>DependencyGraph"]
    T --> U{"Conflict?"}
    
    U -->|No| V["âœ… Execute Successfully"]
    U -->|Yes| W["ğŸ” Livelock Check"]
    
    W --> X{"Cycle?"}
    X -->|No| Y["âš™ï¸ Resolve Conflict"]
    X -->|Yes| Z["â¸ï¸ Defer"]
    
    Y --> V
    Z --> V
    
    V --> AA["ğŸ’¾ Calculate State Root<br/>JMT Root Hash"]
    AA --> AB{"State Root<br/>Matches?"}
    
    AB -->|No| AC["âŒ Execution Error<br/>State mismatch"]
    AB -->|Yes| AD["âœ… Block Finalized<br/>State committed"]
    
    AD --> AE["ğŸ“‹ Update Mempool<br/>- Remove executed<br/>- Retry deferred<br/>- Remove aborted"]
    AE --> AF["ğŸ Execution Complete"]
    
    style A fill:#ff6b6b,stroke:#c92a2a,color:#fff
    style B fill:#4dabf7,stroke:#1971c2,color:#fff
    style C fill:#51cf66,stroke:#2f9e44,color:#fff
    style M fill:#51cf66,stroke:#2f9e44,color:#fff
    style R fill:#51cf66,stroke:#2f9e44,color:#fff
    style G fill:#da77f2,stroke:#9c36b5,color:#fff
    style K fill:#da77f2,stroke:#9c36b5,color:#fff
    style W fill:#da77f2,stroke:#9c36b5,color:#fff
    style AD fill:#51cf66,stroke:#2f9e44,color:#fff
