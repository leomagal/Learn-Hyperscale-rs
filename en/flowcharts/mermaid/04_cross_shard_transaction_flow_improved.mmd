graph TD
    A["ğŸš€ Cross-Shard Transaction<br/>Spans Multiple Shards"] --> B["ğŸ“‹ Identify Shards<br/>Source & Destination"]
    B --> C["ğŸ”— Shard 1: Source<br/>Prepare Phase"]
    
    C --> D["âœ… Validate Transaction<br/>- Signature<br/>- Sufficient Balance"]
    D -->|Invalid| E["âŒ Reject"]
    E --> F["ğŸ End"]
    
    D -->|Valid| G["âš™ï¸ Execute Source<br/>- Deduct Balance<br/>- Create CommitmentProof"]
    G --> H["ğŸ“œ CommitmentProof<br/>Cryptographic proof of execution"]
    
    H --> I["ğŸ“¤ Send CommitmentProof<br/>to Destination Shard"]
    I --> J["ğŸ”— Shard 2: Destination<br/>Commit Phase"]
    
    J --> K["ğŸ“¥ Receive CommitmentProof"]
    K --> L["âœ… Verify CommitmentProof<br/>- Signature valid?<br/>- Source executed?"]
    
    L -->|Invalid| M["âŒ Reject<br/>Invalid proof"]
    M --> N["ğŸ”„ Rollback Source<br/>Refund balance"]
    N --> F
    
    L -->|Valid| O["ğŸ“‹ Categorize in Block<br/>Priority Transaction<br/>(has CommitmentProof)"]
    O --> P["ğŸŸ¢ Ready State<br/>Included in block"]
    
    P --> Q["ğŸ—³ï¸ Consensus<br/>Nodes vote on block"]
    Q --> R["ğŸ–ï¸ QC Created<br/>2f+1 consensus"]
    
    R --> S["âœ… Block Committed<br/>Two-chain rule"]
    S --> T["âš™ï¸ Execute Destination<br/>- Add Balance<br/>- Finalize"]
    
    T --> U{"Execution<br/>Success?"}
    
    U -->|Yes| V["âœ… Transaction Finalized<br/>Both shards updated"]
    U -->|No| W["ğŸ”„ Rollback<br/>Revert both shards"]
    
    V --> X["ğŸ’¾ Update State Root<br/>Both shards"]
    W --> X
    
    X --> Y["ğŸ“‹ Update Mempool<br/>Remove from pending"]
    Y --> F
    
    style A fill:#ff6b6b,stroke:#c92a2a,color:#fff
    style C fill:#4dabf7,stroke:#1971c2,color:#fff
    style J fill:#4dabf7,stroke:#1971c2,color:#fff
    style G fill:#51cf66,stroke:#2f9e44,color:#fff
    style H fill:#ffd43b,stroke:#f59f00,color:#000
    style O fill:#51cf66,stroke:#2f9e44,color:#fff
    style T fill:#51cf66,stroke:#2f9e44,color:#fff
    style V fill:#51cf66,stroke:#2f9e44,color:#fff
    style W fill:#ff8787,stroke:#fa5252,color:#fff
