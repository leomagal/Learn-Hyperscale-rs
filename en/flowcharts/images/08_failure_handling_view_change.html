<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Mermaid Renderer</title>
    
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: "Noto Sans CJK SC", "WenQuanYi Zen Hei", "SimSun", "Microsoft YaHei",
                         "Arial Unicode MS", "Arial", sans-serif;
            line-height: 1.6;
            margin: 0;
            background: white;
            color: #333;
        }
         
        .mermaid {
            text-align: center;
            margin: 1.5em 0;
            page-break-inside: avoid;
            background-color: transparent;
        }
        .mermaid svg {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <div class="mermaid">graph TD
    START[&#34;‚è±Ô∏è Round Timeout&lt;br/&gt;Leader Does Not Propose&#34;] --&gt; DETECT[&#34;üö® Detect Failure&lt;br/&gt;Waited X seconds&#34;]
    
    DETECT --&gt; UNLOCK[&#34;üîì Unlock Vote&lt;br/&gt;Remove Vote Lock&#34;]
    
    UNLOCK --&gt; INCREASE_VIEW[&#34;üìà Increment View&lt;br/&gt;View &#43;= 1&lt;br/&gt;Round &#43;= 1&#34;]
    
    INCREASE_VIEW --&gt; NEW_LEADER[&#34;üëë New Leader&lt;br/&gt;Leader = Validator[Round % N]&#34;]
    
    NEW_LEADER --&gt; LEADER_CHECK{&#34;New Leader&lt;br/&gt;is Honest?&#34;}
    
    LEADER_CHECK --&gt;|No| TIMEOUT_AGAIN[&#34;‚è±Ô∏è Timeout Again&lt;br/&gt;Repeat View Change&#34;]
    TIMEOUT_AGAIN --&gt; INCREASE_VIEW
    
    LEADER_CHECK --&gt;|Yes| PROPOSE_NEW[&#34;üìù New Leader Proposes&lt;br/&gt;Block with HighQC&#34;]
    
    PROPOSE_NEW --&gt; SYNC[&#34;üîÑ Synchronization&lt;br/&gt;Nodes Receive Proposal&#34;]
    
    SYNC --&gt; VALIDATE[&#34;‚úÖ Validate Block&lt;br/&gt;- Valid Parent QC&lt;br/&gt;- Signature OK&#34;]
    
    VALIDATE --&gt;|Invalid| REJECT[&#34;‚ùå Rejects&lt;br/&gt;New Timeout&#34;]
    REJECT --&gt; INCREASE_VIEW
    
    VALIDATE --&gt;|Valid| VOTE_NEW[&#34;üó≥Ô∏è Vote on New Block&#34;]
    
    VOTE_NEW --&gt; COLLECT[&#34;üìä Collect Votes&lt;br/&gt;2f&#43;1 Required&#34;]
    
    COLLECT --&gt; QC_NEW[&#34;üéñÔ∏è QC Created&lt;br/&gt;System Recovered&#34;]
    
    QC_NEW --&gt; PROGRESS[&#34;‚úÖ System Progresses&lt;br/&gt;Consensus Restored&#34;]
    
    PROGRESS --&gt; END[&#34;üèÅ Back to Normal&#34;]
    
    style START fill:#ff6b6b,stroke:#c92a2a,color:#fff
    style DETECT fill:#ffd43b,stroke:#f59f00,color:#000
    style UNLOCK fill:#4c6ef5,stroke:#1971c2,color:#fff
    style NEW_LEADER fill:#51cf66,stroke:#2f9e44,color:#fff
    style QC_NEW fill:#da77f2,stroke:#9c36b5,color:#fff
    style PROGRESS fill:#9c36b5,stroke:#6c2a8f,color:#fff
</div>
    <script>
        
        if (typeof mermaid !== 'undefined') {
            mermaid.initialize({
                startOnLoad: false,  
                theme: 'default',
                securityLevel: 'loose'
            });
        }

        
        document.addEventListener("DOMContentLoaded", async function() {
            if (typeof mermaid === 'undefined') {
                return;
            }

            const mermaidElements = document.querySelectorAll('.mermaid');
            let hasError = false;

            for (let i = 0; i < mermaidElements.length; i++) {
                const element = mermaidElements[i];
                const mermaidCode = element.textContent.trim();

                try {
                    const { svg } = await mermaid.render('mermaid-diagram-' + i, mermaidCode);
                    element.innerHTML = svg;
                    console.log('Mermaid diagram ' + (i + 1) + ' rendered successfully');
                } catch (error) {
                    hasError = true;
                    console.error('Mermaid rendering error for diagram ' + (i + 1) + ':', error);

                    
                    element.innerHTML = '<div class="mermaid-error" style="color: red; border: 2px solid red; padding: 10px; border-radius: 5px; background: #ffeeee;">' +
                        '<strong>Mermaid Rendering Error (Diagram ' + (i + 1) + '):</strong><br>' +
                        '<code>' + error.message + '</code>' +
                        '</div>';

                    
                    document.body.classList.add('mermaid-render-failed');
                }
            }

            
            window.mermaidRenderComplete = true;
            window.mermaidHasError = hasError;
        });
    </script>
</body>
</html>
